# golambda

This is an example of using schemact4 to  build and  deploy a go lambda aws service.
This build includes auto generated wrapper code and a (kotlin) test client.
The only hand coded service code files are [HelloWorldExtraHandler](gofunctions/schemactgosourcegen/module/helloWorldExtraHandler.go) and [HelloWorldHandler](gofunctions/schemactgosourcegen/module/helloWorldHandler.go)  
Building and deploying results in an AWS CDN that forwards to aws lambda go functions.

Kotlin client tests for these functions are located  [here](externaltest/src/main/kotlin/client) - the client code is autogenerated into folder externaltest/build/schemactsourcegen.


The definition for project is  [here](buildSrc/src/main/kotlin/golambda/schemact/GoLambda.kt).
The rootDomain definition must reference a domain and wild card cert that the logged in user has relevent permission in aws.

## Go code generation
gradle task **gofunctions_genGoCode** creates folder **gofunctions/schemactgosourcegen** and creates these files in that folder: 

go.mod, main.go, Makefile, module/gofunctionsInt.go.

The developer is reponsible for creating the code implemented the required functions however these skeletons will be auto created if they don't exist :
**module/helloWorldExtraHandler.go**, **module/helloWorldHandler.go**.

## building and deploying

### installing java 17

in aws console, this works :
```bash
sudo yum install java-17-amazon-corretto-devel
```



### building and deploying schemact4 libs

This is necessary because these libs are not deployed to a public repo.

```bash
git clone git@github.com:typedpath/schemact4.git
# alternatively


cd schemact4
. ./gradlew publishToMavenLocal
cd schemact-plugin/
. ./gradlew publishToMavenLocal
```

### building and deploying golambda example

```bash
cd ../samples/golambda
# generate the go code + build script
. ./gradlew gofunctions_genGoCode
cd gofunctions/schemactgosourcegen/
# build the aws package
go mod tidy
make
cd ../..
# deploy everything
. ./gradlew golambda_buildAndDeploy
```











